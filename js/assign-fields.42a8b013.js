"use strict";(self["webpackChunk_2022_f2e_week2"]=self["webpackChunk_2022_f2e_week2"]||[]).push([[316],{4645:function(e,t,a){a.d(t,{Tk:function(){return l},kj:function(){return s},vp:function(){return i}});a(2801),a(7658);window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://mozilla.github.io/pdf.js/build/pdf.worker.js";const n=e=>new Promise(((t,a)=>{const n=new FileReader;n.addEventListener("load",(()=>t(n.result))),n.addEventListener("error",a),n.readAsDataURL(e)})),i=async e=>{const t="data:application/pdf;base64,";e=await n(e);const a=atob(e.substring(t.length)),i=await window.pdfjsLib.getDocument({data:a}).promise;return i.numPages},l=async e=>{const t=1/window.devicePixelRatio;return new window.fabric.Image(e,{id:"renderPDF",scaleX:t,scaleY:t})},s=async e=>{const t="data:application/pdf;base64,";e=await n(e);const a=atob(e.substring(t.length)),i=await window.pdfjsLib.getDocument({data:a}).promise,l=i.numPages;console.log("totalPages: ",l);const s=async e=>{const t=await i.getPage(e),a=t.getViewport({scale:window.devicePixelRatio}),n=document.createElement("canvas"),l=n.getContext("2d");n.height=a.height,n.width=a.width;const s={canvasContext:l,viewport:a},o=t.render(s);return o.promise.then((()=>n))},o=[];for(let n=1;n<=l;n++){const e=await s(n);o.push(e)}return{pagesCanvas:o,pages:l}}},9659:function(e,t,a){a.r(t),a.d(t,{default:function(){return ct}});var n=a(3396),i=a(7139),l=a(9242);const s=e=>((0,n.dD)("data-v-5327c8f2"),e=e(),(0,n.Cn)(),e),o={class:"assign-fields-page"},c=s((()=>(0,n._)("div",{class:"logo"},null,-1))),r=s((()=>(0,n._)("span",null,"簽名",-1))),u=s((()=>(0,n._)("span",null,"日期",-1))),d=s((()=>(0,n._)("span",null,"文字",-1))),v={key:1},p=s((()=>(0,n._)("span",null," 簽名 ",-1))),g=s((()=>(0,n._)("span",null," 圖片 ",-1))),m={key:0},f={class:"gutter-box"},w=["src"],h={key:1},b={class:"file-upload-content"},k=["src"],y={key:2},C=s((()=>(0,n._)("span",null," 簽名 ",-1))),_=s((()=>(0,n._)("span",null," 圖片 ",-1))),O={key:3},P={class:"gutter-box"},S={key:4},D=s((()=>(0,n._)("span",{class:"sign-cursor-hint"},"點擊一處貼上",-1))),x=[D];function W(e,t,a,s,D,W){const j=(0,n.up)("SignSendNavbar"),H=(0,n.up)("AssignFiieldHeader"),U=(0,n.up)("a-layout-header"),I=(0,n.up)("PieChartOutlined"),L=(0,n.up)("a-menu-item"),T=(0,n.up)("DesktopOutlined"),F=(0,n.up)("a-menu"),M=(0,n.up)("a-layout-sider"),Y=(0,n.up)("PDFDrawer"),E=(0,n.up)("AssignFieldsContent"),z=(0,n.up)("a-layout-content"),A=(0,n.up)("a-layout"),Z=(0,n.up)("CreateSignCanvas"),B=(0,n.up)("a-tab-pane"),R=(0,n.up)("a-tabs"),V=(0,n.up)("a-radio-button"),K=(0,n.up)("a-col"),N=(0,n.up)("a-row"),$=(0,n.up)("a-radio-group"),q=(0,n.up)("a-button"),X=(0,n.up)("PlusOutlined"),G=(0,n.up)("a-space"),J=(0,n.up)("FileUploader2"),Q=(0,n.up)("a-input"),ee=(0,n.up)("a-modal");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(j,{onOk:e.goNextPage,modalOk:e.modalOk},null,8,["onOk","modalOk"]),(0,n.Wm)(U,{class:"layout-header"},{default:(0,n.w5)((()=>[(0,n.Wm)(H,{visableDrawer:e.visableDrawer,onTogglePreviewSide:e.togglePreviewSide},null,8,["visableDrawer","onTogglePreviewSide"])])),_:1}),(0,n.Wm)(A,{class:"page-layout bg-gray"},{default:(0,n.w5)((()=>[(0,n.Wm)(M,{collapsed:e.collapsed,"onUpdate:collapsed":t[4]||(t[4]=t=>e.collapsed=t),collapsible:"",class:"layout-sider"},{default:(0,n.w5)((()=>[c,(0,n.Wm)(F,{selectedKeys:e.sideNavSelcted,"onUpdate:selectedKeys":t[3]||(t[3]=t=>e.sideNavSelcted=t),mode:"inline"},{default:(0,n.w5)((()=>[(0,n.Wm)(L,{key:"nav-name",onClick:t[0]||(t[0]=t=>e.clickSignBtn("name"))},{default:(0,n.w5)((()=>[(0,n.Wm)(I),r])),_:1}),(0,n.Wm)(L,{key:"nav-date",onClick:t[1]||(t[1]=t=>e.clickSignBtn("date"))},{default:(0,n.w5)((()=>[(0,n.Wm)(T),u])),_:1}),(0,n.Wm)(L,{key:"nav-text",onClick:t[2]||(t[2]=t=>e.clickSignBtn("text"))},{default:(0,n.w5)((()=>[(0,n.Wm)(T),d])),_:1})])),_:1},8,["selectedKeys"])])),_:1},8,["collapsed"]),(0,n.Wm)(A,{style:{position:"relative"}},{default:(0,n.w5)((()=>[(0,n.Wm)(Y,{visable:e.visableDrawer,onOnClose:e.drawerOnClose,images:e.images},null,8,["visable","onOnClose","images"]),(0,n.Wm)(z,{class:"layout-content"},{default:(0,n.w5)((()=>[(0,n.Wm)(E,{onUpdateImages:e.updateImages,onClickCanvas:e.clickCanvas,onClickSign:t[5]||(t[5]=t=>e.clickSignBtn("name")),onClickDate:t[6]||(t[6]=t=>e.clickSignBtn("date")),onClickText:t[7]||(t[7]=t=>e.clickSignBtn("text"))},null,8,["onUpdateImages","onClickCanvas"])])),_:1})])),_:1})])),_:1}),(0,n.Wm)(ee,{visible:e.modalVisible,"onUpdate:visible":t[14]||(t[14]=t=>e.modalVisible=t),width:e.modalWidth,title:e.modalTitle,afterClose:e.afterCloseModal,onOk:e.handleOk,footer:null},{default:(0,n.w5)((()=>[e.modeIs("sign")?((0,n.wg)(),(0,n.j4)(Z,{key:0,onCompeleteSign:e.compeleteSign},null,8,["onCompeleteSign"])):e.modeIs("signDefault")?((0,n.wg)(),(0,n.iD)("div",v,[(0,n.Wm)(R,{activeKey:e.modalMenuTabSelected,"onUpdate:activeKey":t[8]||(t[8]=t=>e.modalMenuTabSelected=t)},{default:(0,n.w5)((()=>[(0,n.Wm)(B,{key:"1"},{tab:(0,n.w5)((()=>[p])),_:1}),(0,n.Wm)(B,{key:"2"},{tab:(0,n.w5)((()=>[g])),_:1})])),_:1},8,["activeKey"]),"1"===e.modalMenuTabSelected?((0,n.wg)(),(0,n.iD)("div",m,[(0,n.Wm)(G,{size:16,direction:"vertical",style:{display:"flex"}},{default:(0,n.w5)((()=>[e.signHistories.length>0?((0,n.wg)(),(0,n.j4)($,{key:0,class:"w-full",value:e.selectedSign,"onUpdate:value":t[9]||(t[9]=t=>e.selectedSign=t)},{default:(0,n.w5)((()=>[(0,n.Wm)(N,{gutter:[16,16],wrap:!0},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.signHistories,(e=>((0,n.wg)(),(0,n.j4)(K,{class:"gutter-row",span:24,key:e.id},{default:(0,n.w5)((()=>[(0,n._)("div",f,[(0,n.Wm)(V,{style:{width:"100%","text-align":"center"},value:e.imgSrc},{default:(0,n.w5)((()=>[(0,n._)("img",{src:e.imgSrc,alt:"",height:"50",class:"custom-sign-img"},null,8,w)])),_:2},1032,["value"])])])),_:2},1024)))),128))])),_:1})])),_:1},8,["value"])):(0,n.kq)("",!0),(0,n.Wm)(q,{class:"save",type:"primary",onClick:e.clickUseBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("使用 ")])),_:1},8,["onClick"]),(0,n.Wm)(q,{block:"",class:"sign-btn",onClick:e.createSign,style:{height:"50px"}},{default:(0,n.w5)((()=>[(0,n.Uk)(" 創建簽名 "),(0,n.Wm)(X)])),_:1},8,["onClick"])])),_:1})])):"2"===e.modalMenuTabSelected?((0,n.wg)(),(0,n.iD)("div",h,[(0,n._)("div",b,[(0,n.Wm)(J,{onUploadSuccess:e.uploadSuccess},null,8,["onUploadSuccess"]),(0,n.Wm)($,{value:e.selectedImg,"onUpdate:value":t[10]||(t[10]=t=>e.selectedImg=t)},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.updateLoadImageList,(e=>((0,n.wg)(),(0,n.j4)(V,{value:e.id,key:e.id},{default:(0,n.w5)((()=>[(0,n._)("img",{src:e.url,alt:"",width:"126",height:"126"},null,8,k)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])]),(0,n.Wm)(q,{class:"save",type:"primary",onClick:e.clickUseImgBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("使用 ")])),_:1},8,["onClick"])])):(0,n.kq)("",!0)])):e.modeIs("img")?((0,n.wg)(),(0,n.iD)("div",y,[(0,n.Wm)(R,{activeKey:e.modalMenuTabSelected,"onUpdate:activeKey":t[11]||(t[11]=t=>e.modalMenuTabSelected=t)},{default:(0,n.w5)((()=>[(0,n.Wm)(B,{key:"1"},{tab:(0,n.w5)((()=>[C])),_:1}),(0,n.Wm)(B,{key:"2"},{tab:(0,n.w5)((()=>[_])),_:1})])),_:1},8,["activeKey"]),(0,n.Wm)(q,{class:"save",type:"primary",onClick:e.clickUseBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("使用2 ")])),_:1},8,["onClick"])])):e.modeIs("date")?((0,n.wg)(),(0,n.iD)("div",O,[(0,n.Wm)(G,{size:16,direction:"vertical",style:{display:"flex"}},{default:(0,n.w5)((()=>[(0,n.Wm)($,{value:e.selectedDate,"onUpdate:value":t[12]||(t[12]=t=>e.selectedDate=t)},{default:(0,n.w5)((()=>[(0,n.Wm)(N,{gutter:[16,16],wrap:!0},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.dateList,(e=>((0,n.wg)(),(0,n.j4)(K,{class:"gutter-row",span:12,key:e.id},{default:(0,n.w5)((()=>[(0,n._)("div",P,[(0,n.Wm)(V,{style:{width:"100%","text-align":"center"},value:e.text},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.text),1)])),_:2},1032,["value"])])])),_:2},1024)))),128))])),_:1})])),_:1},8,["value"]),(0,n.Wm)(q,{class:"save",type:"primary",onClick:e.clickUseDateBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("使用 ")])),_:1},8,["onClick"])])),_:1})])):e.modeIs("text")?((0,n.wg)(),(0,n.iD)("div",S,[(0,n.Wm)(G,{size:16,direction:"vertical",style:{display:"flex"}},{default:(0,n.w5)((()=>[(0,n.Wm)(Q,{value:e.selectedText,"onUpdate:value":t[13]||(t[13]=t=>e.selectedText=t),size:"large",placeholder:"請輸入文字"},null,8,["value"]),(0,n.Wm)(q,{class:"save",type:"primary",onClick:e.clickUseTexteBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("使用 ")])),_:1},8,["onClick"])])),_:1})])):(0,n.kq)("",!0)])),_:1},8,["visible","width","title","afterClose","onOk"]),(0,n.wy)((0,n._)("div",{ref:"signSampleDom",class:"signSampleDom",style:(0,i.j5)({top:`${e.mouse.y+10}px`,left:`${e.mouse.x+10}px`})},x,4),[[l.F8,e.insertMode]])])}a(7658);var j=a(7081),H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 518H506V160c0-4.4-3.6-8-8-8h-26a398.46 398.46 0 00-282.8 117.1 398.19 398.19 0 00-85.7 127.1A397.61 397.61 0 0072 552a398.46 398.46 0 00117.1 282.8c36.7 36.7 79.5 65.6 127.1 85.7A397.61 397.61 0 00472 952a398.46 398.46 0 00282.8-117.1c36.7-36.7 65.6-79.5 85.7-127.1A397.61 397.61 0 00872 552v-26c0-4.4-3.6-8-8-8zM705.7 787.8A331.59 331.59 0 01470.4 884c-88.1-.4-170.9-34.9-233.2-97.2C174.5 724.1 140 640.7 140 552c0-88.7 34.5-172.1 97.2-234.8 54.6-54.6 124.9-87.9 200.8-95.5V586h364.3c-7.7 76.3-41.3 147-96.6 201.8zM952 462.4l-2.6-28.2c-8.5-92.1-49.4-179-115.2-244.6A399.4 399.4 0 00589 74.6L560.7 72c-4.7-.4-8.7 3.2-8.7 7.9V464c0 4.4 3.6 8 8 8l384-1c4.7 0 8.4-4 8-8.6zm-332.2-58.2V147.6a332.24 332.24 0 01166.4 89.8c45.7 45.6 77 103.6 90 166.1l-256.4.7z"}}]},name:"pie-chart",theme:"outlined"},U=H,I=a(9388);function L(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){T(e,t,a[t])}))}return e}function T(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var F=function(e,t){var a=L({},e,t.attrs);return(0,n.Wm)(I.Z,L({},a,{icon:U}),null)};F.displayName="PieChartOutlined",F.inheritAttrs=!1;var M=F,Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 140H96c-17.7 0-32 14.3-32 32v496c0 17.7 14.3 32 32 32h380v112H304c-8.8 0-16 7.2-16 16v48c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-48c0-8.8-7.2-16-16-16H548V700h380c17.7 0 32-14.3 32-32V172c0-17.7-14.3-32-32-32zm-40 488H136V212h752v416z"}}]},name:"desktop",theme:"outlined"},E=Y;function z(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){A(e,t,a[t])}))}return e}function A(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Z=function(e,t){var a=z({},e,t.attrs);return(0,n.Wm)(I.Z,z({},a,{icon:E}),null)};Z.displayName="DesktopOutlined",Z.inheritAttrs=!1;var B=Z,R=a(4870),V=a(65);const K=e=>((0,n.dD)("data-v-0b3f0b59"),e=e(),(0,n.Cn)(),e),N={class:"create-sign-canvas"},$={ref:"canvas",id:"canvas",width:"598",height:"202",class:"border-neutral-4 bg-neutral-2",style:{"border-style":"solid","border-width":"1px"}},q={class:"btn-group"},X=K((()=>(0,n._)("div",{class:"color-btn bg-neutral-7"},null,-1))),G=K((()=>(0,n._)("div",{class:"color-btn",style:{"background-color":"#2766e0"}},null,-1))),J=K((()=>(0,n._)("div",{class:"color-btn",style:{"background-color":"#f64331"}},null,-1)));function Q(e,t,a,i,l,s){const o=(0,n.up)("a-menu-divider"),c=(0,n.up)("a-button"),r=(0,n.up)("PlusOutlined"),u=(0,n.up)("a-space");return(0,n.wg)(),(0,n.iD)("div",N,[(0,n._)("div",null,[(0,n._)("canvas",$,null,512),(0,n.Wm)(o),(0,n._)("div",q,[(0,n.Wm)(c,{class:"save",type:"primary",onClick:s.clickSaveBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("使用 ")])),_:1},8,["onClick"]),(0,n.Wm)(c,{class:"clear",type:"primary",ghost:"",onClick:s.reset},{default:(0,n.w5)((()=>[(0,n.Uk)("清除 ")])),_:1},8,["onClick"]),(0,n.Wm)(u,{class:"colors-pick",size:12},{default:(0,n.w5)((()=>[X,G,J,(0,n.Wm)(r)])),_:1})])])])}var ee=a(3848),te={emits:["compeleteSign"],components:{PlusOutlined:j.Z},data(){return{canvasInstance:null,isPainting:!1}},mounted(){const e=this.$refs.canvas,t=e.getContext("2d");t.lineWidth=4,t.lineCap="round",this.canvasInstance=e,e.addEventListener("mousedown",this.startPosition),e.addEventListener("mouseup",this.finishedPosition),e.addEventListener("mouseleave",this.finishedPosition),e.addEventListener("mousemove",this.draw),e.addEventListener("touchstart",this.startPosition),e.addEventListener("touchend",this.finishedPosition),e.addEventListener("touchcancel",this.finishedPosition),e.addEventListener("touchmove",this.draw)},methods:{getCtx(){const e=this.canvasInstance.getContext("2d");return e},getPaintPosition(e){const t=this.canvasInstance.getBoundingClientRect();return"mousemove"===e.type?{x:e.clientX-t.left,y:e.clientY-t.top}:{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}},startPosition(e){e.preventDefault(),this.isPainting=!0},finishedPosition(){this.isPainting=!1,this.getCtx().beginPath()},draw(e){if(!this.isPainting)return;const t=this.getPaintPosition(e);this.getCtx().lineTo(t.x,t.y),this.getCtx().stroke()},reset(){this.getCtx().clearRect(0,0,this.canvasInstance.width,this.canvasInstance.height)},clickSaveBtn(){const e=this.canvasInstance.toDataURL("image/png");this.$emit("compeleteSign",e)},downloadPDF2(){(0,ee.W)(this.canvasInstance)}}},ae=a(89);const ne=(0,ae.Z)(te,[["render",Q],["__scopeId","data-v-0b3f0b59"]]);var ie=ne;const le={class:"preview-container"},se=["onClick"],oe=["src"],ce={class:"page-item"};function re(e,t,a,l,s,o){const c=(0,n.up)("a-empty"),r=(0,n.up)("a-drawer");return(0,n.wg)(),(0,n.j4)(r,{class:"pdf-drawer",title:e.drawerTitle,placement:"right",closable:!0,width:250,headerStyle:{textAlign:"right"},maskStyle:{backgroundColor:"transparent"},autofocus:!1,visible:e.visable,"get-container":!1,style:{position:"absolute",zIndex:5,width:250},onClose:e.onClose},{default:(0,n.w5)((()=>[(0,n._)("div",le,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.images,(t=>((0,n.wg)(),(0,n.iD)("div",{key:t.page,class:"preview-item"},[(0,n._)("div",{class:(0,i.C_)(["preview-img-item",e.activePage===t.page?["bg-primary-2"]:["bg-neutral-2","cursor-pointer"]]),onClick:a=>e.setActivePage(t.page)},[(0,n._)("img",{src:t.image,alt:""},null,8,oe)],10,se),(0,n._)("div",ce,[(0,n._)("div",{class:(0,i.C_)(["page",e.activePage===t.page?["bg-primary-1","text-white"]:["cursor-pointer"]])},(0,i.zw)(t.page),3)])])))),128))]),0===e.images.length?((0,n.wg)(),(0,n.j4)(c,{key:0})):(0,n.kq)("",!0)])),_:1},8,["title","visible","onClose"])}var ue=(0,n.aZ)({components:{},props:{visable:{type:Boolean},images:{type:Array}},setup(e,{emit:t}){const a=(0,R.iH)(1),i=(0,n.Fl)((()=>0===e.images.length?"--/--":`${a.value}/${e.images.length}頁`)),l=e=>{a.value=e},s=()=>{t("onClose",!1)};return{drawerTitle:i,onClose:s,setActivePage:l,activePage:a}}});const de=(0,ae.Z)(ue,[["render",re],["__scopeId","data-v-3aab8655"]]);var ve=de,pe=a(2566);const ge={class:"tool-bar-container"},me={class:"view-wrapper"},fe={class:"viewer-container"},we={key:0,class:"viewer"};function he(e,t,a,i,l,s){const o=(0,n.up)("PlusOutlined"),c=(0,n.up)("a-button"),r=(0,n.up)("MinusOutlined"),u=(0,n.up)("CompressOutlined"),d=(0,n.up)("a-space"),v=(0,n.up)("EditOutlined"),p=(0,n.up)("CalendarOutlined"),g=(0,n.up)("FontSizeOutlined"),m=(0,n.up)("PageCanvas");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",ge,[(0,n.Wm)(d,{size:0,class:"tool-bar"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{class:"tool-btn",onClick:e.clickScaleUp},{default:(0,n.w5)((()=>[(0,n.Wm)(o)])),_:1},8,["onClick"]),(0,n.Wm)(c,{class:"tool-btn",onClick:e.clickScaleDown},{default:(0,n.w5)((()=>[(0,n.Wm)(r)])),_:1},8,["onClick"]),(0,n.Wm)(c,{class:"tool-btn",onClick:t[0]||(t[0]=t=>e.$emit("toggleScreen"))},{default:(0,n.w5)((()=>[(0,n.Wm)(u)])),_:1})])),_:1}),(0,n.Wm)(d,{size:0,class:"tool-bar mobile"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{class:"tool-btn",onClick:t[1]||(t[1]=t=>e.$emit("clickSign"))},{default:(0,n.w5)((()=>[(0,n.Wm)(v)])),_:1}),(0,n.Wm)(c,{class:"tool-btn",onClick:t[2]||(t[2]=t=>e.$emit("clickDate"))},{default:(0,n.w5)((()=>[(0,n.Wm)(p)])),_:1}),(0,n.Wm)(c,{class:"tool-btn",onClick:t[3]||(t[3]=t=>e.$emit("clickText"))},{default:(0,n.w5)((()=>[(0,n.Wm)(g)])),_:1})])),_:1})]),(0,n._)("div",me,[(0,n._)("div",fe,[e.pdfAllPageCanvas.length>0?((0,n.wg)(),(0,n.iD)("div",we,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.pdfAllPageCanvas,((a,i)=>((0,n.wg)(),(0,n.iD)("div",{class:"page-container",key:a},[(0,n.Wm)(m,{canvas:a,page:i+1,onOnCanvasLoaded:e.onCanvasLoaded,onClickCanvas:t[4]||(t[4]=(t,a)=>e.$emit("clickCanvas",t,a))},null,8,["canvas","page","onOnCanvasLoaded"])])))),128))])):(0,n.kq)("",!0)])])],64)}var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M326 664H104c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V696c0-17.7-14.3-32-32-32zm16-576h-48c-8.8 0-16 7.2-16 16v176H104c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V104c0-8.8-7.2-16-16-16zm578 576H698c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V744h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm0-384H746V104c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16z"}}]},name:"compress",theme:"outlined"},ke=be;function ye(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){Ce(e,t,a[t])}))}return e}function Ce(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _e=function(e,t){var a=ye({},e,t.attrs);return(0,n.Wm)(I.Z,ye({},a,{icon:ke}),null)};_e.displayName="CompressOutlined",_e.inheritAttrs=!1;var Oe=_e,Pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"},Se=Pe;function De(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){xe(e,t,a[t])}))}return e}function xe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var We=function(e,t){var a=De({},e,t.attrs);return(0,n.Wm)(I.Z,De({},a,{icon:Se}),null)};We.displayName="MinusOutlined",We.inheritAttrs=!1;var je=We,He=a(3318),Ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 416H616c-4.4 0-8 3.6-8 8v112c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-56h60v320h-46c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h164c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8h-46V480h60v56c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V424c0-4.4-3.6-8-8-8zM656 296V168c0-4.4-3.6-8-8-8H104c-4.4 0-8 3.6-8 8v128c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-64h168v560h-92c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-92V232h168v64c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8z"}}]},name:"font-size",theme:"outlined"},Ie=Ue;function Le(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){Te(e,t,a[t])}))}return e}function Te(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Fe=function(e,t){var a=Le({},e,t.attrs);return(0,n.Wm)(I.Z,Le({},a,{icon:Ie}),null)};Fe.displayName="FontSizeOutlined",Fe.inheritAttrs=!1;var Me=Fe,Ye=a(2962),Ee=a(2074),ze=a(4645);const Ae={ref:"canvasDom",width:"500",height:"300"};function Ze(e,t,a,i,l,s){return(0,n.wg)(),(0,n.iD)("div",{class:"page-canvas",onClick:t[0]||(t[0]=t=>e.$emit("clickCanvas",e.selfCanvas,e.page))},[(0,n._)("canvas",Ae,null,512)])}var Be=(0,n.aZ)({emits:["onCanvasLoaded","clickCanvas"],props:{canvas:{type:HTMLCanvasElement},page:{type:Number}},setup(e,{emit:t}){const a=(0,R.iH)(null),i=(0,R.iH)();(0,n.bv)((()=>{l()}));const l=async()=>{const n=new window.fabric.Canvas(a.value),l=e.canvas,s=await(0,ze.Tk)(l);n.setWidth(s.width/window.devicePixelRatio),n.setHeight(s.height/window.devicePixelRatio),n.setBackgroundImage(s,n.renderAll.bind(n)),t("onCanvasLoaded",e.page,n),i.value=n};return{renaderCanvas:l,canvasDom:a,selfCanvas:i}}});const Re=(0,ae.Z)(Be,[["render",Ze],["__scopeId","data-v-a2a98bfc"]]);var Ve=Re,Ke=(0,n.aZ)({emits:["updateImages","clickCanvas","clickScaleUp","clickScaleDown","toggleScreen","clickSign","clickDate","clickText"],components:{PageCanvas:Ve,CreateSignCanvas:ie,PDFDrawer:ve,CompressOutlined:Oe,MinusOutlined:je,PlusOutlined:j.Z,EditOutlined:He.Z,FontSizeOutlined:Me,CalendarOutlined:Ye.Z},setup(e,{emit:t}){const a=(0,V.oR)(),i=(0,R.iH)([]),l=(0,R.iH)([]);let s=[];const o=(0,R.iH)(0);(0,n.bv)((()=>{Ee.ZP.success({content:"載入中 ...",prefixCls:"bg-neutral-2"});const e=a.state.pdfFile;e&&r(e.originFileObj)}));const c=e=>{s=[],i.value=[],e.target.files[0]&&(r(e.target.files[0]),a.commit("SET_PDF_FILE",{originFileObj:e.target.files[0]}))},r=async e=>{const{pagesCanvas:t,pages:a}=await(0,ze.kj)(e);o.value=a,i.value=t},u=(e,n)=>{s.push(n);const i=n.toDataURL("image/png");l.value.push({page:e,image:i}),s.length===o.value&&(t("updateImages",l.value),a.commit("SET_CANVAS_LIST",s))},d=()=>{(0,ee.q)(s)},v=()=>{},p=()=>{},g=()=>{};return{pdfAllPageCanvas:i,canvasInstanceList:s,renderPDF:r,onCanvasLoaded:u,images:l,clickScaleUp:v,clickScaleDown:p,toggleScreen:g,inputOnChange2:c,downloadPDF2:d}}});const Ne=(0,ae.Z)(Ke,[["render",he],["__scopeId","data-v-b6bb5c1e"]]);var $e=Ne,qe=a(466);const Xe=e=>{const t=new Date,a=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),l=e.replace("YYYY",a).replace("MM",n).replace("DD",i);return l};var Ge=a(2065);const Je=(0,n._)("div",{class:"ant-upload-text"},"Upload",-1);function Qe(e,t,a,i,l,s){const o=(0,n.up)("loading-outlined"),c=(0,n.up)("plus-outlined"),r=(0,n.up)("a-upload");return(0,n.wg)(),(0,n.j4)(r,{"file-list":e.fileList,"onUpdate:file-list":t[0]||(t[0]=t=>e.fileList=t),customRequest:e.customRequest,accept:"application/png",name:"avatar","list-type":"picture-card",class:"avatar-uploader2","show-upload-list":!1,"before-upload":e.beforeUpload,onChange:e.handleChange},{default:(0,n.w5)((()=>[(0,n._)("div",null,[e.loading?((0,n.wg)(),(0,n.j4)(o,{key:0})):((0,n.wg)(),(0,n.j4)(c,{key:1})),Je])])),_:1},8,["file-list","customRequest","before-upload","onChange"])}var et=a(2510);function tt(e,t){const a=new FileReader;a.addEventListener("load",(()=>t(a.result))),a.readAsDataURL(e)}var at=(0,n.aZ)({emits:["upload-success"],components:{LoadingOutlined:et.Z,PlusOutlined:j.Z},setup(e,{emit:t}){const a=(0,V.oR)(),n=(0,R.iH)([]),i=(0,R.iH)(!1),l=(0,R.iH)(""),s=e=>new Promise((t=>{setTimeout((()=>{t(e.file.status="done")}),2e3)})),o=e=>{c(e.file)&&(setTimeout((()=>{"done"!==e.file.status&&(e.file.status="done",o(e))}),1e3),"uploading"!==e.file.status?"done"===e.file.status&&(a.commit("SET_PDF_FILE",e.file),tt(e.file.originFileObj,(e=>{l.value=e,i.value=!1,Ee.ZP.success("上傳成功"),t("upload-success",l.value)}))):i.value=!0)},c=e=>{const t=e.size/1024/1024<10;return t},r=e=>{const t=c(e);return t||Ee.ZP.error("檔案超過 10MB，請選擇其他檔案上傳"),t};return{fileList:n,loading:i,imageUrl:l,handleChange:o,beforeUpload:r,customRequest:s}}});const nt=(0,ae.Z)(at,[["render",Qe]]);var it=nt,lt=a(2483),st=(0,n.aZ)({name:"AssignFields",components:{AssignFiieldHeader:pe.Z,AssignFieldsContent:$e,CreateSignCanvas:ie,FileUploader2:it,PDFDrawer:ve,SignSendNavbar:Ge.Z,PlusOutlined:j.Z,PieChartOutlined:M,DesktopOutlined:B},setup(){const e=(0,V.oR)(),t=(0,lt.tv)(),a=(0,R.qj)((0,qe.iiK)()),i=(0,R.iH)(null),l=(0,R.iH)(!1),s=(0,R.iH)(""),o=(0,n.Fl)((()=>"nav-name"===r.value[0]&&"sign"===c.value&&"1"===p.value?"646px":"412px")),c=(0,R.iH)("text"),r=(0,R.iH)(["nav-text"]),u=(0,R.iH)(""),d=(0,R.iH)(""),v=(0,R.iH)([]),p=(0,R.iH)("1"),g=(0,R.iH)(""),m=(0,R.iH)([{id:1,text:Xe("YYYY/MM/DD")},{id:2,text:Xe("DD/MM/YYYY")},{id:3,text:Xe("YYYY-MM-DD")},{id:4,text:Xe("MM-DD-YYYY")}]),f=(0,n.Fl)((()=>e.state.signHistories)),w=(0,R.iH)(""),h=(0,R.iH)([]),b=(0,R.iH)(!1),k=(0,R.iH)(!1);(0,n.wF)((()=>{const a=e.state.pdfFile;a||(Ee.ZP.success({content:"檔案載入失敗",prefixCls:"bg-neutral-2"}),t.replace({name:"task"}))})),(0,n.bv)((()=>{e.commit("SET_PROGRESS_STATE",2)}));const y=e=>{switch(e){case"name":S("signDefault","");break;case"date":S("date","日期");break;case"text":S("text","文字");break;default:break}_()},C=e=>{S("sign","創建簽名")},_=()=>{l.value=!0},O=e=>{l.value=!1},P=()=>{l.value=!1},S=(e,t)=>{c.value=e,s.value=t},D=()=>{s.value="",c.value="signDefault"},x=e=>c.value===e,W=()=>{c.value="signDefault"},j=t=>{e.commit("ADD_SIGN_HISTORY",{id:Date.now(),imgSrc:t}),D()},H=()=>{P(),b.value=!0},U=()=>{P(),b.value=!0},I=()=>{P(),b.value=!0},L=()=>{P(),b.value=!0},T=()=>{},F=e=>{const t=e._previousPointer.x,a=e._previousPointer.y,n=new window.fabric.Text(g.value,{left:t,top:a,hasControls:!0});e.add(n)},M=e=>{const t=e._previousPointer.x,a=e._previousPointer.y,n=new window.fabric.Text(u.value,{left:t,top:a,hasControls:!0});e.add(n)},Y=e=>{const t=v.value.find((e=>e.id===d.value));A(e,{x:a.x,y:a.y,imgSrc:t.url})},E=e=>{A(e,{x:a.x,y:a.y,imgSrc:w.value})},z=(e,t)=>{if(!b.value)return;const a=r.value[0];return"nav-name"===a&&"2"===p.value?(Y(e),void(b.value=!1)):"nav-name"===a&&"1"===p.value?(E(e),void(b.value=!1)):"nav-date"===a?(F(e),void(b.value=!1)):void("nav-text"===a&&(M(e),b.value=!1))},A=(e,t)=>{window.fabric.Image.fromURL(t.imgSrc,(function(t){const a=e._previousPointer.x,n=e._previousPointer.y;t.top=n,t.left=a,t.scaleX=.4,t.scaleY=.4,e.add(t)}))},Z=e=>{h.value=[],h.value=e},B=()=>{k.value?N():K()},K=()=>{k.value=!0},N=()=>{k.value=!1},$=e=>{v.value.push({url:e,id:Date.now()})},q=()=>{t.push({name:"compelete"})},X=()=>{e.commit("SET_PDF_FILE",null),t.replace({name:"task"})};return{selectedSign:w,signHistories:f,modeIs:x,compeleteSign:j,clickSignBtn:y,createSign:C,clickUseBtn:U,modalTitle:s,modalVisible:l,modalMenuTabSelected:p,modalWidth:o,showModal:_,handleOk:O,handleCancel:P,afterCloseModal:W,collapsed:(0,R.iH)(!1),sideNavSelcted:r,visableDrawer:k,togglePreviewSide:B,showPreviewSide:K,drawerOnClose:N,images:h,updateImages:Z,mouse:a,signSampleDom:i,insertMode:b,clickFollowBtn:T,clickCanvas:z,selectedDate:g,dateList:m,clickUseDateBtn:I,selectedText:u,clickUseTexteBtn:L,updateLoadImageList:v,uploadSuccess:$,clickUseImgBtn:H,selectedImg:d,modalOk:X,goNextPage:q}}});const ot=(0,ae.Z)(st,[["render",W],["__scopeId","data-v-5327c8f2"]]);var ct=ot}}]);
//# sourceMappingURL=assign-fields.42a8b013.js.map